# Distribute Work
This directory contains example code for using the Rust [Tonic gRPC
library](https://github.com/hyperium/tonic) to send simple messages
representing work from a centralized server to clients (workers). The
communication between the server and client is secured with JSON Web
Tokens generated with SSH keys.

## SSH Keys
New SSH keys should be generated for use with the work distribution
mechanism.  This is due to standard SSH key generation writing keys in
a format that is not supported by the JSON Web Token library and there
not seeming to be any way to convert existing keys in
rust. Additionally, I did not want to modify the filesystem without
users' knowledge, and thus made this an explicit setup step users must
do.

```bash
ssh-keygen -t rsa -b 4096 -m PEM -f private.key
rm private.key.pub
ssh-keygen -f private.key -e -m PKCS8 > public.key
```

## Data Structures
The data structures sent over the network are generated by
protobuf. The specification is found in the `proto` directory.

## Build
```bash
cargo build
```

## Run
Server: `cargo run --bin server [options] <port> <client count>`

Client: `cargo run --bin client [options] <server> <port>`

## Work Distribution
Currently, 10 hardcoded work items are distributed amongst the clients
that connect to the server. If the server was initialized with 3
expected clients, work will be distributed like so:

- Client 0: 4 work items
- Client 1: 3 work items
- Client 2: 3 work items
- Client 3: 0 work items

In the future, work will still be expected to be known before the
server is started.
