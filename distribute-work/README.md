# Distribute Work
This directory contains example code for using the Rust [Tonic gRPC
library](https://github.com/hyperium/tonic) to send simple messages
representing work from a centralized server to clients (workers). The
communication between the server and client is secured with TLS.

## TLS
TLS keys and certificates should be generated for use with the server
and client. Pre-generated keys and certificates may be found in the
[tonic repository](https://github.com/hyperium/tonic/tree/master/examples/data/tls),
specifically `server.{key,pem}` for the server, and `ca.pem` for the
client.

By default, they are expected to be in `distribute-work/tls`, but can
be changed with arguments to the server and cllient.

## Data Structures
The data structures sent over the network are generated by
protobuf. The specification is found in the `proto` directory.

## Build
```bash
cargo build
```

## Run
Server: `cargo run --bin server [options] <port> <client count>`

Client: `cargo run --bin client [options] <server> <port>`

## Work Distribution
Currently, 10 hardcoded work items are distributed amongst the clients
that connect to the server. If the server was initialized with 3
expected clients, work will be distributed like so:

- Client 0: 4 work items
- Client 1: 3 work items
- Client 2: 3 work items
- Client 3: 0 work items

In the future, work will still be expected to be known before the
server is started.
